from mongoconnect import *

codelist = [1, 2, 9, 12, 21, 24, 27, 31, 39, 46, 59, 60, 61, 63, 69, 89, 100, 157, 301, 338, 401, 402, 422, 423, 425, 488, 527, 528, 538, 559, 562, 568, 612, 623, 625, 630, 631, 651, 652, 667, 680, 685, 686, 690, 709, 717, 718, 728, 729, 758, 768, 778, 780, 783, 792, 793, 800, 807, 822, 825, 839, 858, 876, 878, 895, 897, 898, 900, 917, 927, 932, 933, 937, 951, 959, 960, 968, 969, 983, 999, 2001, 2007, 2024, 2028, 2122, 2128, 2142, 2155, 2202, 2242, 2244, 2275, 600000, 600004, 600005, 600006, 600008, 600009, 600010, 600011, 600015, 600016, 600017, 600018, 600019, 600022, 600026, 600027, 600028, 600029, 600030, 600031, 600033, 600036, 600037, 600048, 600050, 600058, 600062, 600066, 600068, 600085, 600087, 600089, 600096, 600100, 600102, 600104, 600108, 600109, 600111, 600118, 600123, 600125, 600132, 600143, 600150, 600151, 600153, 600158, 600161, 600166, 600169, 600170, 600176, 600177, 600183, 600188, 600196, 600208, 600210, 600216, 600219, 600220, 600221, 600236, 600239, 600246, 600251, 600256, 600266, 600269, 600270, 600271, 600276, 600282, 600307, 600309, 600312, 600316, 600320, 600325, 600331, 600348, 600350, 600352, 600362, 600369, 600376, 600380, 600383, 600395, 600415, 600418, 600426, 600428, 600432, 600456, 600489, 600497, 600500, 600508, 600516, 600517, 600518, 600519, 600528, 600547, 600549, 600550, 600569, 600582, 600583, 600585, 600588, 600595, 600596, 600597, 600598, 600600, 600601, 600611, 600631, 600635, 600638, 600639, 600642, 600643, 600648, 600649, 600655, 600657, 600660, 600663, 600664, 600674, 600675, 600685, 600688, 600690, 600694, 600717, 600718, 600737, 600739, 600741, 600748, 600779, 600782, 600795, 600804, 600808, 600809, 600811, 600812, 600816, 600820, 600832, 600835, 600837, 600839, 600859, 600874, 600875, 600879, 600881, 600886, 600895, 600900, 600970, 600997, 601001, 601006, 601009, 601088, 601099, 601107, 601111, 601166, 601168, 601169, 601186, 601318, 601328, 601333, 601390, 601398, 601588, 601600, 601601, 601618, 601628, 601666, 601668, 601699, 601727, 601766, 601808, 601857, 601866, 601872, 601898, 601899, 601918, 601919, 601939, 601958, 601988, 601991, 601998]
#record = starindustry.find({}).sort('code')
with open('vote_industry.csv','w',encoding='utf8') as f:
    head = 'code, 行业, 占比, 行业, 占比, 行业, 占比, | , 产品, 占比, 产品, 占比, 产品, 占比, -'
    f.write(head+'\n')
    for co in codelist:
        code= '0000000'+str(co)
        code = code[-6:]
        indu = starindustry.find_one({'code':code},projection={'code':0,'_id':0})
        prod = starproduct.find_one({'code': code},projection={'code':0,'_id':0})
        if not indu:
            continue
        ind = sorted(indu.items(), key=lambda d: float(d[1].strip('%')), reverse=True)
        pro = sorted(prod.items(), key=lambda d: float(d[1].strip('%')), reverse=True)
        # print(ind)
        # exit()
        # print(pro)
        print(code)
        ss = code + ',' 
        n1 ,n2 = 0,0
        for it in ind:    
            k, v = it[0], it[1] 
            n1 +=1
            if n1 > 3:
                break
            ss+=str(k) +', '+str(v)+', '

        if n1 ==0:
            ss+='-,-,-,-,-,-,'
        if n1 ==1:
            ss+='-,-,-,-,'
        if n1 ==2:
            ss+='-,-,'
        ss+='|,'

        for it in pro:  
            k, v = it[0], it[1]           
            n2 +=1
            if n2 > 3:
                break
            ss+=str(k) +', '+str(v)+', '
            
        f.write(ss+'-\n')

